<section class="menu" id="product">
  <div class="container-fluid">
    <div class="row text-center">
      <h4 class="heading fw-bold">menu</h4>
    </div>
    <!-- Responsive Dropdown for Small Screens -->
    <div class="row d-md-none px-2">
      <select
        name="responsive-menu"
        id="responsive-menu"
        [(ngModel)]="selectedValue"
        (change)="applyFilter()"
      >
        <option value="">all</option>
        <option value="co">coffee</option>
        <option value="te">tea</option>
        <option value="ic">ice blend</option>
        <option value="tp">topping</option>
        <option value="ca">cake</option>
      </select>
    </div>

    <!-- Sidebar for Desktop Screens -->
    <div class="row">
      <div class="col-md-2 d-none d-md-block mt-5">
        <aside class="sidebar-menu mt-5">
          <ul class="d-flex flex-column gap-3">
            <li>
              <button class="sidebar-menu-item" (click)="applyFilter('all')">
                all
              </button>
            </li>
            <li>
              <button class="sidebar-menu-item" (click)="applyFilter('coffee')">
                coffee
              </button>
              <ul class="sidebar-menu-lv2 mt-3 d-flex flex-column gap-3">
                <li>
                  <button
                    class="sidebar-menu-item"
                    (click)="applyFilter('coffee', 'no-milk')"
                  >
                    no milk
                  </button>
                </li>
                <li>
                  <button
                    class="sidebar-menu-item"
                    (click)="applyFilter('coffee', 'milk')"
                  >
                    milk
                  </button>
                </li>
              </ul>
            </li>
            <li>
              <button class="sidebar-menu-item" (click)="applyFilter('tea')">
                tea
              </button>
              <ul class="sidebar-menu-lv2 mt-3 d-flex flex-column gap-3">
                <li>
                  <button
                    class="sidebar-menu-item"
                    (click)="applyFilter('tea', 'no-milk')"
                  >
                    no milk
                  </button>
                </li>
                <li>
                  <button
                    class="sidebar-menu-item"
                    (click)="applyFilter('tea', 'milk')"
                  >
                    milk
                  </button>
                </li>
              </ul>
            </li>
            <li>
              <button
                class="sidebar-menu-item"
                (click)="applyFilter('ice-blend')"
              >
                ice blend
              </button>
            </li>
            <li>
              <button
                class="sidebar-menu-item"
                (click)="applyFilter('topping')"
              >
                topping
              </button>
            </li>
            <li>
              <button class="sidebar-menu-item" (click)="applyFilter('cake')">
                cake
              </button>
            </li>
          </ul>
        </aside>
      </div>

      <!-- Items Display Section -->
      <div class="col-md-10">
        <div class="row row-cols-2 row-cols-md-4 px-2 mt-2 g-3 list-item">
          <div class="col" *ngFor="let item of filteredItems">
            <div
              class="card"
              (click)="openModal(item)"
              data-bs-toggle="modal"
              data-bs-target="#itemModal"
            >
              <img
                [src]="
                  '../../assets/imgs/menu/' +
                  item.main_group +
                  '/' +
                  item.sub_group +
                  '/' +
                  item.image
                "
                class="card-img-top"
                alt="{{ item.name }}"
              />
              <div class="card-body">
                <h5 class="card-title item-name fw-bold">{{ item.name }}</h5>
                <p class="card-text item-price mt-2">
                  <strong>{{ item.price | number : "1.0-0" }} ₫</strong>
                </p>
                <p class="card-text item-desc mt-2">{{ item.description }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Cart Button -->
    <button class="btn-cart" (click)="toggleCartModal()">
      <i
        class="bi bi-cart-plus-fill"
        style="color: var(--main-bg-color-dark)"
      ></i>
      <span *ngIf="cartCount > 0" class="cart-count">{{ cartCount }}</span>
    </button>
  </div>
</section>

<!-- Modal for Item Details -->
<div
  class="modal fade"
  id="itemModal"
  tabindex="-1"
  aria-labelledby="itemModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title" id="itemModalLabel">
          {{ selectedItem?.name }}
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-4 d-flex align-items-center justify-content-center">
            <img
              [src]="
                '../../assets/imgs/menu/' +
                selectedItem?.main_group +
                '/' +
                selectedItem?.sub_group +
                '/' +
                selectedItem?.image
              "
              class="img-fluid modal-image rounded"
              alt="{{ selectedItem?.name }}"
            />
          </div>
          <div class="col-8">
            <p class="modal-desc text-muted mb-3">
              {{ selectedItem?.description }}
            </p>
            <p class="fw-bold display-6">
              {{ selectedItem?.price | number : "1.0-0" }} ₫
            </p>

            <!-- Quantity Selection -->
            <div class="quantity-selector mt-3">
              <label for="itemQuantity" class="form-label fw-bold"
                >Quantity:</label
              >
              <div class="input-group input-group-sm">
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="decreaseModalQuantity()"
                >
                  −
                </button>
                <input
                  id="itemQuantity"
                  type="number"
                  class="form-control text-center"
                  [(ngModel)]="modalQuantity"
                  (input)="onQuantityInputChange()"
                  style="width: 50px"
                />
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="increaseModalQuantity()"
                >
                  +
                </button>
              </div>
            </div>

            <!-- Sugar Level Selection -->
            <div class="sugar-level mt-3">
              <label for="sugarLevel" class="form-label fw-bold"
                >Sugar Level:</label
              >
              <select
                id="sugarLevel"
                class="form-select"
                [(ngModel)]="sugarLevel"
                (change)="setSugarLevel(sugarLevel)"
              >
                <option value="no-sugar">No Sugar</option>
                <option value="less">Less</option>
                <option value="normal">Normal</option>
                <option value="extra">Extra</option>
              </select>
            </div>

            <!-- Ice Level Selection -->
            <div class="ice-level mt-3">
              <label for="iceLevel" class="form-label fw-bold"
                >Ice Level:</label
              >
              <select
                id="iceLevel"
                class="form-select"
                [(ngModel)]="iceLevel"
                (change)="setIceLevel(iceLevel)"
              >
                <option value="no-ice">No Ice</option>
                <option value="less">Less</option>
                <option value="normal">Normal</option>
                <option value="extra">Extra</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="btn btn-primary w-100 py-2"
          (click)="addToCart()"
          data-bs-dismiss="modal"
        >
          ADD TO CART
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cart Modal -->
<div
  class="modal fade"
  id="cartModal"
  tabindex="-1"
  aria-labelledby="cartModalLabel"
  aria-hidden="true"
  [ngClass]="{ show: isCartModalOpen }"
  [style.display]="isCartModalOpen ? 'block' : 'none'"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="cartModalLabel">Your Shopping Cart</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="toggleCartModal()"
        ></button>
      </div>
      <div class="modal-body">
        <div *ngIf="cartItems.length === 0" class="text-center py-3">
          <p class="text-muted">Your cart is empty!</p>
        </div>
        <div
          *ngFor="let item of cartItems"
          class="cart-item d-flex align-items-center mb-3 p-2 border-bottom"
        >
          <img
            [src]="
              '../../assets/imgs/menu/' +
              item.main_group +
              '/' +
              item.sub_group +
              '/' +
              item.image
            "
            alt="{{ item.name }}"
            class="cart-item-image rounded me-3"
            style="width: 80px; height: 80px; object-fit: cover"
          />
          <div class="flex-grow-1">
            <p class="fw-bold mb-1 text-capitalize">{{ item.name }}</p>
            <p class="text-muted mb-1">{{ item.price | number : "1.0-0" }} ₫</p>
            <p class="mb-1">
              Sugar Level:
              <span class="text-capitalize">{{ item.sugarLevel }}</span>
            </p>
            <p>
              Ice Level:
              <span class="text-capitalize">{{ item.iceLevel }}</span>
            </p>
          </div>
          <!-- Quantity Controls -->
          <div class="quantity-controls ms-3">
            <div class="input-group input-group-sm">
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="decreaseQuantity(item)"
              >
                −
              </button>
              <input
                type="number"
                class="form-control text-center"
                [(ngModel)]="item.quantity"
                (input)="updateCartCount(); calculateTotalPrice()"
                style="width: 50px"
              />
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="increaseQuantity(item)"
              >
                +
              </button>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="mt-3">
          <label for="orderNotes" class="form-label fw-bold"
            >Order Notes:</label
          >
          <textarea
            id="orderNotes"
            class="form-control"
            [(ngModel)]="orderNotes"
            rows="3"
            placeholder="Add any special instructions or notes for your order"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <div>
          <h5 class="mb-0">
            Total Price: {{ totalPrice | number : "1.0-0" }} ₫
          </h5>
        </div>
        <button type="button" class="btn btn-primary" (click)="checkout()">
          Checkout
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div
  class="modal fade"
  id="checkoutModal"
  tabindex="-1"
  aria-labelledby="checkoutModalLabel"
  aria-hidden="true"
  [ngClass]="{ show: isCheckoutModalOpen }"
  [style.display]="isCheckoutModalOpen ? 'block' : 'none'"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="checkoutModalLabel">Order Details</h5>
        <button
          type="button"
          class="btn-close"
          (click)="toggleCheckoutModal()"
        ></button>
      </div>
      <div class="modal-body">
        <!-- Choose Service Type -->
        <div class="mb-3">
          <label class="form-label">Choose Service Type:</label>
          <select class="form-select" [(ngModel)]="serviceType">
            <option value="dineIn">Dine In</option>
            <option value="delivery">Delivery</option>
          </select>
        </div>

        <!-- Dine In Form -->
        <div *ngIf="serviceType === 'dineIn'">
          <div class="mb-3">
            <label class="form-label">Name:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="customerName"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Phone Number:</label>
            <input
              type="tel"
              class="form-control"
              [(ngModel)]="customerPhone"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Payment Method:</label>
            <select class="form-select" [(ngModel)]="paymentMethod">
              <option value="cash">Cash</option>
              <option value="card">Card</option>
            </select>
          </div>
        </div>

        <!-- Delivery Form -->
        <div *ngIf="serviceType === 'delivery'">
          <div class="mb-3">
            <label class="form-label">Name:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="customerName"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Phone Number:</label>
            <input
              type="tel"
              class="form-control"
              [(ngModel)]="customerPhone"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Address:</label>
            <textarea
              class="form-control"
              [(ngModel)]="deliveryAddress"
            ></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Payment Method:</label>
            <select class="form-select" [(ngModel)]="paymentMethod">
              <option value="cash">Cash on Delivery</option>
              <option value="card">Card</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="confirmOrder()">
          Confirm Order
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Success Popup -->
<div
  class="modal fade"
  id="successModal"
  tabindex="-1"
  aria-labelledby="successModalLabel"
  aria-hidden="true"
  [ngClass]="{ show: isSuccessModalOpen }"
  [style.display]="isSuccessModalOpen ? 'block' : 'none'"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModalLabel">Order Successful</h5>
      </div>
      <div class="modal-body text-center">
        <p>Thank you for your order!</p>
        <p>
          Your queue number is: <strong>{{ queueNumber }}</strong>
        </p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="closeSuccessModal()"
        >
          OK
        </button>
      </div>
    </div>
  </div>
</div>
